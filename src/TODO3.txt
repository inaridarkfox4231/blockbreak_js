さてと。
どこからPlayに来るのか
うん
SelectModeから来るのはLevel開始時の1回だけ
それ以外はClearから来ることになっている
Playでやることは多いので整理する

SelectModeから来たら
1.スコアを0に戻す
2.レベルとモードの情報を登録してステージ番号を0に戻す
3.モード情報をもとにボールのライフを設定する
以下は共通の処理
4.ボールのデータをリセットする（ライフには手を付けないで）（何をリセットするかはおいおい）
5.レベルとステージ番号とモードからjsonの一部を切り出してステージのデータを取得
  それを元にパドル配列、ボール、ブロック列、ガターの準備を行なう
  この「準備」でつまづいちゃってるのよ
  内容に関してはPlayのupdateとdrawで何をやるかから調べるべき

Playでやること
一番最初はステージ番号を60フレーム表示しないといけない（以降は番号が左上に表示される）

グラフィックの表示に成功。一歩前進。2021/02/11

形ができてきたら選択肢の作り方も洗練させて動かしやすくしたいわね

ステージ番号の表示に成功。2021/02/11

ガターは画像先に作っといてdrawはそれを貼り付ける、gameSystemのgrに。
そのうえで別に当たり判定を用意する感じで。
反射についてはcolliderに直接用意する、継承とかはしない感じで。
ブロックは描画の仕方は性質から決まる、それとは別に当たり判定。
パドルも描画の仕方はパラメータから、それとは別に当たり判定。それでいく。
まず描画だけする
ボールもあらかじめ画像つくっておいてそれを貼り付ける方向で。大きさが変化しないのでその方がいいね。

ガター、パドル、ボール。最初はそこから。ブロックはあとで。
ガターの表示に成功。やったね！
先にブロック
2つ用意しました。おけおけ。

まずブロックね

パドル作れ。
パドル動かしたよ。ボール作って。さらに乗せる。
乗せたよ。

クリックでボールが出るようにする
衝突はしなくていい
ブロック飛んだ。じゃあ衝突判定（明日以降ね）

お目汚し失礼しました。（？？）ああ、こっちのこと。関係ない。引き続き、よろしく。

ブロックで反射するようになったので次はガターですね。で、アウト判定すると。

次はゲームオーバーの処理作ってください
あとボールがやられるときに一瞬だけポインターが出るのなんとかして
解決した
ゲームオーバーね。おけおけ。
じゃあクリアつくろうか。でもその前にブロック壊せないといけない。パーティクルは後回しでいい。
もうブロックにはぶつかれるんだから、・・その前にパワーアップか。パワーアップでしか壊せない仕様作ってあるんだし。

--------------------------アイデア------------------
えーと、斜めのブロック。円状のブロック。そんなとこ。あと、ボールのパワード状態の持続を円で表すなど。
それから
---------------------------------------------------

順序
０．パドルのアクティベートをもうちょい分かりやすく。
１．パワーアップ作る（2段階）
２．パワーアップの時間継続を表現（といっても円弧描くだけでいい）
３．ブロック壊す仕様を実装
４．クリア実装
５．オールクリア実装
６．ポーズ機能。ひとまず完成
７．まだまだいっぱい・・とりあえず、パーティクルとかステージ番号とかその辺。

仕様変更。パドルはクリックのたびにアクティブとノンアクティブを切り替えられるようにする。以上。
あと、マウスの0~1を画面のサイズに対応させるのもよろしくね
おっけー
じゃあクリア判定。NORMALをすべて壊したら終了です。確定事項。
形はrectだったり円だったり色々。とにかくすべて壊す。
んー・・40x40とか分裂するのもあれ、まあいいや。
スペースキーでポーズと切り替え

パドルとの衝突について。端っこの場合に・・です。
やっぱ側面はスルーさせないとだめね・・オプションで何とかするか。

おはよー
ガターをパドルすれすれにしたら平和が訪れた。いぇい。
じゃあ次はアークパドル作るかな。円環型のガターも作らないと。

// なんかもうめんどくさいから全部クリックで済ませるのもありかな
// タイトル画面に説明との行き来だけ用意してあとクリックでモード選択してクリックでレベル選択してスタートするの。
// 今はいいや。

// タイトルの下に矢印クリックしてモード選択、ステージも選択。で、playクリックしてplayスタートみたいな。

で、次にやること・・あの、えー。gameSystemはcolorMode(HSB, 100)にする。で、ブロック色んな色を出したい。
タフ0は全部白でいい、1と2についてそれをカラーで。

色はいいよまた今度で。
それよりアーク。それ終わったらテスト。それ終わったらステージ作ったりやることいっぱいあるんで。


ごめん
やっぱ色でタフさを表現するやり方に戻す。
もうその方がいいと思うから。それ、今なら可能でしょ・・黄色 オレンジ 赤 紫 青でOK. ピンク。そして硬いブロックは
硬いブロックで別に。えーと、硬いブロックの場合は・・めんどくさい
赤より上なら硬いから強い攻撃が要る。で、いいじゃん。オレンジまでなら通常アタックで壊せる。それで行こう。はい。
18, 10, 0, 78, 65です。これを配列に。ピンクは88で。

そうね
当たり判定・・んー。じゃあ、えーと、かどっちょで±15°だっけ。じゃあね、その範囲で補間するか。線型補間でいいか。
と思ったけどパドルだけにしないとめんどいことになるね。ああもう。。。
でもまあいいか。

ぶつけたときのブロックのタフさに応じて音を出す。CDEFGの和音とかその辺。あとLIFEUPはLの文字出すといいかも。

タイトル画面から直接ゲーム画面に飛んだ方がいいって言われたのでそうするみたい。

修正点まとめ
タイトルでクリックでレベルと難易度選べるようにする
色は選ばれてないのを灰色にするくらいで選ばれてるのを色付ける。同じ色でいい。
エンターキーでも移行できるようにするがクリックスペースを設ける（playって書く）
それぞれパーツごとにグラフィックでまとめて全体をセンタリングして配置
ボールの周囲に円を用意してそれが小さくなっていくことでリミット表現
パドルのアクティブは今のままで・・とりあえず
効果時間は120フレームやっぱ用意しないと面白くないだろということで

/*
廃止
class SelectLevel extends State{
	constructor(_node){
		super(_node);
		this.name = "selectLevel";
		this.choice = 0;
		this.choiceLength = 6; // 0:TO TITLE, 1～5:各レベル（実際は0～4）
		this.txt = ["TO TITLE", "LEVEL 0", "LEVEL 1", "LEVEL 2", "LEVEL 3", "LEVEL 4"];
		this.base = createGraphics(CANVAS_W, CANVAS_H);
		this.drawPrepare();
	}
  drawPrepare(){
		this.base.background(40, 128, 255);
		this.gr.textSize(30);
		this.gr.noStroke();
		this.gr.textFont(huiFont);
	}
	prepare(_state){
		// choice変数を0に戻さないと
		this.choice = 0;
	}
  keyAction(code){
    // 上下キーで選択、エンターキーでtitleまたはmodeに移行
    switch(code){
      case K_UP:
        this.choice = (this.choice + this.choiceLength - 1) % this.choiceLength;
        break;
      case K_DOWN:
        this.choice = (this.choice + 1) % this.choiceLength;
        break;
      case K_ENTER:
        if(this.choice === 0){
          this.setNextState("title");
        }else{
          this.setNextState("selectMode");
        }
        break;
    }
	}
	update(){
		// そうね・・やること、ないわね・・
	}
	draw(){
    this.gr.image(this.base, 0, 0);
		let col = [0, 0, 0, 0, 0, 0];
		col[this.choice] += 255;
		const left = 135;
		if(col[0] > 0){ this.gr.fill(0); this.gr.rect(left, 40, 130, 30); }
		this.gr.fill(col[0]);
		this.gr.text(this.txt[0], left + 2, 63);
		for(let k = 1; k < 6; k++){
			if(col[k] > 0){ this.gr.fill(0); this.gr.rect(left, 70 + 50 * k, 183, 30); }
			this.gr.fill(col[k]);
			this.gr.text(this.txt[k], left + 2, 93 + 50 * k);
		}
    image(this.gr, 0, 0);
	}
}

// このページで操作説明する
// 難易度はEASY, NORMAL, HARD, CRAZYの4種類でいこうか（同じ仕様でやる）
// 難易度ごとに色変える感じで（青→緑→黄色→赤）
class SelectMode extends State{
	constructor(_node){
		super(_node);
		this.name = "selectMode";
		this.base = createGraphics(CANVAS_W, CANVAS_H);
		this.level = 0; // selectからレベルの情報を受け取る。playに渡す。
		this.levelText = ""; // STAGE--～--のテキストをコピーする感じ
		this.choice = 0; // playのdifficultyとなる値。modeという名前になってるのは、要するに選択画面では常に"mode"という名前を使うってだけの話。
		// playの方でlevelとdifficulty,更にステージ番号1～5に応じてステージが生成されてゲームが行われる
		// ライフ0になったらタイトルに強制的に戻されクリアの場合は次のステージに進み全部クリアしたらやはりタイトルに戻る（スコア表示後）
		// セーブ機能は無いけどまあスコアがセレクト画面に記録されるくらいはいいかなって思うけども（クッキー使う？）
		this.choiceLength = 5; // 0:TO SELECT, 1～4:難易度。
		this.txt = ["TO SELECT", "EASY", "NORMAL", "HARD", "CRAZY"];
		this.drawPrepare();
	}
  drawPrepare(){
		this.base.background(128);
		/* ここでインストラクション書いた方がいいかもなぁ */
		this.gr.textSize(30);
		this.gr.noStroke();
		this.gr.textFont(huiFont);
	}
	prepare(_state){
		// モード変数を0に戻す。
		this.choice = 0;
		// ModeにはSelectからしか来ることができないのでlevelをここでSelectの情報を元に設定
		this.level = _state.choice - 1; // 0～4
		this.levelText = _state.txt[_state.choice]; // それに応じたテキスト
	}
  keyAction(code){
    // 上下キーで選択、エンターキーでselectまたはplayに移行
    switch(code){
      case K_UP:
        this.choice = (this.choice + this.choiceLength - 1) % this.choiceLength;
        break;
      case K_DOWN:
        this.choice = (this.choice + 1) % this.choiceLength;
        break;
      case K_ENTER:
        if(this.choice === 0){
          this.setNextState("selectLevel");
        }else{
					// SelectModeからplayに行くときとclearからplayに行くときで処理を若干変える。
					// 仕事はほぼgameSystemに一任する。
          this.setNextState("play");
        }
        break;
		}
	}
	update(){
		// まあ、やることは、ないわな・・
	}
	draw(){
    this.gr.image(this.base, 0, 0);
		let col = [0, 0, 0, 0, 0];
		col[this.choice] += 255;
		const left = 35;
		const top = 80;
		this.gr.fill(0);
		this.gr.text("--" + this.levelText +" is choosed--", left + 2, top + 23 - 50);
		if(col[0] > 0){ this.gr.fill(0); this.gr.rect(left, top, 140, 30); }
		this.gr.fill(col[0]);
		this.gr.text(this.txt[0], left + 2, top + 23);
		for(let k = 1; k < 5; k++){
			if(col[k] > 0){ this.gr.fill(0); this.gr.rect(left, top + 30 + 50 * k, 103, 30); }
			this.gr.fill(col[k]);
			this.gr.text(this.txt[k], left + 2, top + 53 + 50 * k);
		}
    image(this.gr, 0, 0);
	}
}

*/

先にshoot, 去年作ったあれ、からパーティクルシステムを拝借してこっちに利用させてもらう。
ブロック壊すときはhopなし、ボールが砕け散る時はhopありで。ブロックの方は星型、ボールの方は四角形辺りかな・・
あとガーターはそのうち以前作ったラーヴァでやりたいかも。その、シェーダで・・特定の場所だけそれで・・

衝突点から出るように修正して。ボールの側で位置に速度足せばいい（中心に速度方向だけ半径で）

円形ブロックは短調にするとかしたら面白そう

ブロックが全部壊れたらボールは停止、ってやった方がいいのと
あとパドルが端っこまで行かないように修正、それでもダメっぽいけどね・・んー仕方ない。
アイデアとしては、NORMALが全て壊れているというフラグと、パーティクルがすべて無くなっているというフラグを用意して、
NORMALがすべて壊れているフラグが立った時点でボールの移動をやめ、
双方のフラグが揃った時点でクリア判定とする、というものかな。

もうパドルめんどくさいな
どうしたって例のバグは避けられない
かくなるうえは両側ループさせるしかないかもしれない
それか強制的にワープさせるとか

はい
なるほどね。ガターチェックはそのときの位置に対してやるけど反射処理は違うと、そこら辺ですね・・・
んー。。やっぱ分けた方がいいかな・・速度足しちゃうのはまずいわ。
ガターチェックでは重なるかどうかしか見ないからな。そこは、確かにまずい。

めり込みどうしたら避けられるの・・もうわからん
どうやら真剣に両側ループを考えないといけない・・・？それか周囲マグマにしちゃうとか。
周囲マグマにしてパドル4本用意するとかね。そうすればめり込みようがない。ねぇ？（ねぇじゃねぇよ）

プレイ画面の背景、歯車とか過去のスケッチとかでもいいかもね。

関係ないけどこれの解析よろしくね（なぜ・・・）
https://twitter.com/zozuar/status/1361344020778221579
N snoise2D(p.xz
float i,g,e=1.;for(vec3 p;i++<2e2&&e>.001;){p=vec3((FC.xy-r*.5)/r.y*g+1.,g);
p.y-=.5*g;e=p.y-N-t*.5)*.02+N*2.+t)*.01;
g+=e*.5;}o+=sqrt(cos(i/2e2))*vec4(.1,.36,.4,0)+sin(i/5e2)*vec4(9,3,1.6,0);
他にもPCD2021とかつぶプロで気になるコードあったら解析よろしく～（並列意思が欲しい・・・）

当面の目標
上のシェーダー解析
エディタ作る
弾避けゲームのアイデア出す
以上～

パターン1:下面にパドル1個
パターン2:上面と下面にパドル1個ずつ
パターン3:両サイドにパドル1個ずつ
パターン4:中央に反対向きにパドル背中合わせ1個ずつ
パターン5:上下左右4方向にパドル1個ずつ
とりあえず壊せるブロックの配置のところを簡略化しようね
上60の部分は確定なのでそれはおいといて
円形ブロック用意した方がいいと思う
ringWallsはこれでOK.

ゲームスタート時のアニメーションの・・レンガ状に分割してそれぞれのパートでその、右から左にぐーっと。
長方形ごとに色々ある。ブラインドが。レベルごとに違うブラインドを用意したら面白いかもね。
120フレームにして60,60でそれぞれ。うん。
レベル1～5はそのまま移植でいいと思う。6～10で、
6:上下に左右パドル。600x600
7:左右に上下パドル。600x600
8:上下左右にパドル。600x600
9:左右に上下パドル、まんなかにも上下パドル。800x640フルサイズ
10:上下に左右パドル、まんなかにも左右パドル。800x640フルサイズ。

// LIFEUPのブロック、今日作ったハートマーク付けようっと

パワーアップ実装。スピードは変えずにパワーだけ上げる。条件は1段階アップの状態でパドル反射。あとスピード+1.
そのまま+240する。240になるまで強化状態が続く感じ。
で、攻撃力が・・黄色を壊すときに貫通するとかそこら辺。

現時点でどんな仕様変更すればいいのかだけまとめとくか
斜めブロックの反射の仕様を作ってアークパドル廃止するのをやらないとレベル10以降のステージ作れない
アークパドルやめたい
あれはダメなやつだから

音追加した(C3～B3)
あとなんか原因不明のボールが画面外に消失するバグが・・・
画面外でも死なない仕様だから（ガター判定）処理できなくてボールどっか行っちゃった
仕方ないから暫定措置で画面外出たら死ぬようにするか・・それで解決するわけじゃないけど仕方ないわ。
おそらくパドルが画面外にいるときにクリックが反応しちゃうのが原因ぽいな。だから
開始数フレーム後はクリックが機能しないようにマージンを設けるといいかもしれない。

ポーズからタイトルに戻りたい。テキスト：TO PLAY: PRESS SPACE, TO TITLE: PRESS ENTER
なんかもうライフの概念やめたいかな・・自由にやりたい感。もういっそいわゆるあれ、死にゲー路線で行きたい。
そうなるとハートマークが意味をなさなくなるけど仕方ないね。いちいち最初に戻るの憂鬱なんだよな。
どこからでも始められてクリアすると自動的に次のステージ、で、ポーズからいつでもタイトルに戻れるようにしよう。
難易度はEASYとNORMALとHARDだけにしてパドルの長さだけ変える。それでいこう。

ライフ、やめます！！！！LIFEUPも廃止・・いろいろ変えないとね。面白く、ないです。

とはいえあれなので、ステージごとにライフ設けて、10回ミスったら最初から・・（そのステージの最初から）
ていうかステージごとにアウトの制限設けるのもありかもかな・・んー。
いいや。やめよ。スコアも要らないか。うん。自由に。

というわけで、現時点でどんな仕様変更すればいいのかだけまとめとくか。
1. ライフ廃止、スコア廃止。で、どのステージからでもスタートできるようにし、クリアすると自動的に次のステージが始まる。
必然的にレベルは廃止となる。まあそうはいっても25ずつ分けるけどね・・内容。
また、いつでもポーズ画面からエンターキーでタイトルに戻れるようにする。スペースキーでプレイに戻る。
なので、オールクリアの概念は廃止。最後まで・・出来てるステージの最後まで行ったら最初に戻る。
2. 難易度EASY,NORMAL,HARD,CRAZYは継続。パドルの長さだけ変わる仕様。これは継続で。
3. そういうわけでタイトル画面の仕様も変更する。PLAYボタンを廃止、ステージ番号をマウスダウンしてる間濃い色が横から右へ、
サイズはそれぞれ40x40の大きさ。で、下に40x20のボタンを用意してクリックするとステージの詳細が分かるようにする。
サムネイルと簡単な解説って感じで。まあボタンとか用意してからかなり後でね。
40x40が横に15個、40x15=600で、5ずつ間隔空けると間隔が14個、40x15+5x14=670で800だからOK.
縦・・40x40の40x20の40x65でこれが10間隔・・65x3+10x2で215ですね。670x215と出ました。入る入る。
さらに10あけてモードが80x40で4つで10間隔だから350x40でOK.そんな感じで。クリックで選ぶ。
4. 星型できたのでさっそく実装したい。で、パーティクル。それでOK.
5. できればだけど円形パドルの方、傾いた長方形を使いたいのでその手のコリダー実装してアークを廃止する
6. 音について。25～49は真ん中だけ半音下げて短調にする感じ。（m3,P5,m7）50～74はディミニッシュ（ちょうど4等分）でいく。
7. トランジション
8. こっちのアタックが3のとき1のブロック（というか黄色）を壊すとき反射しないで貫通する仕様。

ていうか、OpenProcessingベースだし、今の仕様だと後ろの方のステージとか出来ないし、もっと自由に作りたいから仕方ないね。

一旦LIFEUP系のブロックなくすか・・・・あれ、GAMEOVERもなくなるね・・わぁ大変だ。
暫定的に、今の仕様でクリックするとstage番号が入力されてそれでそのままLIFEとかも無しでGAMEOVERも無しで順繰りに進んでくみたいな
感じのあれで。それで。LIFEの代わりに強制パワーアップとかそういうの用意したい
円形のブロックで動いてるの用意して（遅いスピード）ぶつかると対象の中心からボールに向かう方向にスピードが固定されてかつ1段階レベルアップ
そういうのアリだと思う
しいて言えばノーミスに価値があるっていうんだったらそういうモード用意してもいいけどその報酬とか何にもないしだったら
要らないよね
やってて気持ちいいかどうかを主眼に据えて作ることにする
遊び方は自由
やられまくって無理やりクリアするの全然OK
上のスペースはとりあえず60は残しておいて。ステージ番号（STAGE 0とかSTAGE 13）だけ表示しといて（左端に）

ボタンの仕様については据え置きで。一番優先したいのはボールを星型にしてパーティクル出すこと。これ第一で考えたい。
